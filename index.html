<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Testikartta</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
    body { margin:0; padding:0; }
    #map { height: 100vh; width: 100%; }
</style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// --- INITIALIZE MAP ---
var map = L.map('map').setView([63.8600, 23.1182], 17);

// --- TILE LAYER ---
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
}).addTo(map);

// --- FIX DEFAULT ICON ---
var defaultIcon = L.icon({
    iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
    shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
});

// --- WAYPOINTS DATA ---
var waypoints = [
    { lat: 63.860433, lng: 23.117852, link: "wp1.html" },
    { lat: 63.859941, lng: 23.118246, link: "wp2.html" },
    { lat: 63.859581, lng: 23.119193, link: "wp3.html" }
];

// --- ADD CLASSIC MARKERS WITH FIXED ICON ---
waypoints.forEach(function(wp) {
    wp.marker = L.marker([wp.lat, wp.lng], { icon: defaultIcon }).addTo(map);
    wp.marker.bindTooltip("Tap to open waypoint", { permanent: false });
    wp.marker.on("click", function() {
        window.top.location.href = wp.link;
    });
});

// --- USER LOCATION MARKER ---
var userMarker = null;

// --- ENABLE GPS TRACKING ---
map.locate({ watch: true, setView: false, enableHighAccuracy: true });

map.on('locationfound', function(e) {
    if (!userMarker) {
        userMarker = L.marker(e.latlng, { icon: defaultIcon }).addTo(map);
    } else {
        userMarker.setLatLng(e.latlng);
    }
});

map.on('locationerror', function() {
    alert("Unable to access your GPS location.");
});
</script>

</body>
</html>
